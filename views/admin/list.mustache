<h1>Soapbox Administration</h1>

{{> logout}}

<p><a href="{{#url}}admin/add{{/url}}" role="button">New Post</a></p>

<table>
	<thead>
		<tr>
			<th>Post</th>
			<th>Date</th>
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>
	{{#posts}}
		<tr>
			<td><a href="{{permalink}}">{{title}}</a></td>
			<td>{{date}}</td>
			<td>
				<a href="{{#url}}admin/edit{{/url}}/{{post_id}}">Edit</a> |
				<a href="{{#url}}admin/delete{{/url}}/{{post_id}}" data-action="delete">Delete</a>
			</td>
		</tr>
	{{/posts}}
	</tbody>
</table>

<script>
	$('a[data-action="delete"]').on("click", function(e){
		e.preventDefault();

		var parent = $(this).closest("tr");

		$.ajax({
			type:"GET",
			url: this.href,
			dataType:'json',
			success: function(response){
				if (response.success === true) {
					$(parent).fadeOut("normal", function(){
						parent.remove();
					});
				} else {
					alert(response.body);
				}
			}
		});
	});
</script>